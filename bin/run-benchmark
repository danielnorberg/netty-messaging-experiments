#!/bin/bash -e

project="netty-messaging-experiments"

dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
jar="$(ls -t $dir/../target/$project*.jar | grep -v sources | grep -v javadoc | head -n 1)"
jar="$(cd $(dirname $jar) && pwd -P)/$(basename $jar)"

: ${JMX_PORT=7091}

echo JMX_PORT=$JMX_PORT

exec java -Dcom.sun.management.jmxremote.port=$JMX_PORT \
          -Dcom.sun.management.jmxremote.ssl=false \
          -Dcom.sun.management.jmxremote.authenticate=false \
          -XX:+UnlockCommercialFeatures -XX:+FlightRecorder \
          -jar $jar \
          "$@"